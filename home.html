<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home | Student Health Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: url("{{ url_for('static', filename='images/download.jpeg') }}") no-repeat center center fixed;
      background-size: cover;
      font-family: 'Poppins', sans-serif;
      color: #fff;
      min-height: 100vh;
      padding-top: 80px; /* space for navbar */
      position: relative;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.85);
      z-index: 0;
      backdrop-filter: blur(5px);
    }

    .fade-in {
      animation: fadeIn 1.2s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 1rem;
      backdrop-filter: blur(10px);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
  </style>
</head>
<body class="fade-in relative">
  <div class="overlay"></div>

  <!-- üåü Sticky Navbar -->
  <nav class="fixed top-0 left-0 w-full z-20 bg-white/10 backdrop-blur-md shadow-md border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <img src="https://cdn-icons-png.flaticon.com/512/3774/3774299.png" class="w-8 h-8" alt="logo" />
        <span class="text-xl font-semibold text-cyan-300">Student Health Portal</span>
      </div>

      <div class="flex items-center space-x-4">
        <span class="text-gray-200">üëã Hello, <strong>{{ username }}</strong></span>
        <a href="/logout" class="bg-cyan-400 text-black px-3 py-1 rounded-md font-semibold hover:bg-cyan-300 transition-all">
          Logout
        </a>
      </div>
    </div>
  </nav>

  <!-- üåø Main Content -->
  <div class="max-w-5xl mx-auto relative z-10">
    <!-- Info Section -->
    <div class="card">
      <h2 class="text-2xl font-semibold text-emerald-400 mb-3">About Lung Cancer</h2>
      <p class="text-gray-200 leading-relaxed">
        Lung cancer arises when abnormal cells in the lungs grow uncontrollably.
        The leading causes include tobacco use, exposure to air pollution, and genetic factors.
        Symptoms often appear late ‚Äî such as persistent coughing, chest pain, and fatigue ‚Äî making early detection vital.
      </p>
      <p class="mt-3 text-gray-300">
        üß† <strong>Health Tip:</strong> Quit smoking, avoid polluted air, exercise regularly, and eat antioxidant-rich foods to strengthen your lungs.
      </p>
    </div>

    <!-- üåç Lung Cancer Chart Section -->
    <div class="card relative overflow-hidden group transition-all duration-300 hover:scale-[1.01] hover:shadow-lg">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-2xl font-semibold text-cyan-300 flex items-center space-x-2">
          <span>üìä Lung Cancer Trends in India</span>
          <span class="text-sm text-gray-400">(2020‚Äì2023)</span>
        </h2>
      </div>

      <canvas id="lungChart" height="160"></canvas>

      <p id="updateInfo" class="text-sm text-gray-400 mt-4 italic text-center">
        Loading live data...
      </p>

      <!-- Decorative gradient overlay -->
      <div class="absolute inset-0 bg-gradient-to-br from-cyan-400/10 via-transparent to-emerald-400/10 opacity-0 group-hover:opacity-100 transition-all"></div>
    </div>

    <!-- Navigation Buttons -->
    <div class="text-center mt-8 space-x-4">
      <a href="/predict" class="text-cyan-300 hover:text-cyan-100">üß† Predict Risk</a>
      <a href="/history" class="text-cyan-300 hover:text-cyan-100">üìú View History</a>
      <a href="/leaving" class="text-cyan-300 hover:text-cyan-100">üö™ Exit</a>
    </div>
  </div>

  <!-- üìà Chart Script -->
  <script>
    async function loadAndDrawLungChart() {
      try {
        const resp = await fetch('/api/lung-data');
        const json = await resp.json();

        const years = json.years;
        const states = json.states;
        const values = json.values;

        const datasets = years.map((year, idx) => {
          const colors = [
            'rgba(34,211,238,0.85)',
            'rgba(99,102,241,0.85)',
            'rgba(16,185,129,0.85)'
          ];
          return {
            label: `Year ${year}`,
            data: values[String(year)],
            backgroundColor: colors[idx % colors.length],
            borderColor: 'rgba(255,255,255,0.9)',
            borderWidth: 1,
            borderRadius: 6
          };
        });

        const ctx = document.getElementById('lungChart').getContext('2d');
        if (window.lungChartInstance) window.lungChartInstance.destroy();

        window.lungChartInstance = new Chart(ctx, {
          type: 'bar',
          data: { labels: states, datasets: datasets },
          options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            scales: {
              x: {
                ticks: { color: 'white' },
                grid: { display: false }
              },
              y: {
                beginAtZero: true,
                ticks: { color: 'white' },
                grid: { color: 'rgba(255,255,255,0.15)' }
              }
            },
            plugins: {
              legend: {
                labels: { color: 'white', font: { weight: 'bold' } }
              },
              tooltip: {
                backgroundColor: 'rgba(15,23,42,0.9)',
                titleColor: '#22d3ee',
                bodyColor: '#fff'
              }
            }
          }
        });

        document.getElementById('updateInfo').innerText =
          `üìÖ Years shown: ${years.join(', ')} ‚Äî Source: data.gov.in / IARC`;
      } catch (err) {
        console.error('Failed to load lung data:', err);
        document.getElementById('updateInfo').innerText =
          '‚ö†Ô∏è Could not load live data ‚Äî showing fallback.';
      }
    }

    loadAndDrawLungChart();
  </script>
</body>
</html>
